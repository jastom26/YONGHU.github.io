<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>枝枝的歌单网站</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- 自动跳转代码 -->
    <script>
        // 自动跳转确保使用 https 和 www 版本
        (function() {
            // 定义目标域名
            const targetDomain = 'www.jastom26.fun';
            
            // 当前访问的域名和协议
            const currentHost = location.hostname;
            const currentProtocol = location.protocol;
            
            // 需要跳转的情况：
            // 1. 使用 HTTP 协议
            // 2. 访问根域名 (jastom26.fun) 而不是 www
            if (currentHost === 'jastom26.fun' || 
                currentHost === targetDomain && currentProtocol !== 'https:') {
                
                // 构建目标 URL
                const targetUrl = `https://${targetDomain}${location.pathname}${location.search}${location.hash}`;
                
                // 仅在需要时才跳转
                if (location.href !== targetUrl) {
                    location.href = targetUrl;
                }
            }
        })();
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">枝枝的歌单</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="index.html">首页</a></li>
                    <li class="nav-item"><a class="nav-link" href="songs.html">歌曲列表</a></li>
                </ul>
                <div class="d-flex">
                    <a href="https://live.douyin.com/869132681818" class="btn btn-sm btn-danger" target="_blank">
                        <i class="bi bi-camera-reels-fill"></i> 进入直播间
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="container mt-4">
        <h1>欢迎来到枝枝的歌单网站！</h1>
        <img src="myphoto.jpg" alt="主播枝枝的抖音头像" class="img-fluid rounded mb-3">
        <div class="intro-box">
            <p><strong>@SL.菘蓝社所属正式生</strong></p>
            <p>运营 @SL.苦槿旗下Viora企划成员）这里是枝枝，你想听的歌都在这里~</p>
            <p>"我肩上是风，风上是闪烁的星辰～"</p>
            <p><strong>【午间出没】</strong> 14:00-15:00 / 18:00-19:30 ・～・。°</p>
            <p><strong>【其他时间随机出现】</strong></p>
            <p><strong>单推符号：</strong> ⛰️</p>
            <p><strong>建模：</strong> 互联网幽澪</p>
        </div>
        
        <!-- 直播宣传区域 - 动态状态 -->
        <div id="liveCard" class="live-card mt-4 p-4 rounded shadow">
            <div class="d-flex align-items-center mb-3">
                <i class="bi bi-broadcast-pin fs-3 me-2"></i>
                <h3 class="m-0" id="liveTitle">枝枝正在直播!</h3>
            </div>
            <p class="fs-5" id="liveMessage">快来直播间和我一起互动吧~</p>
            <a href="https://live.douyin.com/869132681818" 
               class="btn mt-2"
               id="liveBtn"
               target="_blank">
                <i class="bi bi-camera-reels-fill"></i> 立即进入直播间
            </a>
        </div>
        
        <div class="d-flex flex-wrap gap-2 mt-3">
            <!-- 抖音主页按钮 -->
            <a href="https://www.douyin.com/user/MS4wLjABAAAALSsVdbkE3e0PCyvcDyDLK7OdWVbsLpICZHRzL00PyP-wrI_WXXAJT06siM0Jrygh?from_tab_name=main" 
               class="btn btn-purple mt-2">
                <i class="bi bi-house-door"></i> 去我的抖音主页
            </a>
            
            <!-- 直播间按钮 -->
            <a href="https://live.douyin.com/869132681818" 
               class="btn btn-danger mt-2" 
               id="liveButton"
               target="_blank">
                <i class="bi bi-camera-reels-fill"></i> 进入直播间
            </a>
        </div>
        
        <!-- 歌单统计信息 -->
        <div class="stats-box mt-4 p-4 bg-white rounded shadow">
            <h3 class="mb-3">歌单统计</h3>
            <div id="stats" class="text-center">
                <p>正在加载数据...</p>
                <div class="mt-2 alert alert-warning">域名生效中，如遇加载失败请稍后再试</div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 首页统计信息加载
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage获取数据
            const statsData = JSON.parse(localStorage.getItem('songStats')) || null;
            
            if (statsData) {
                updateStatsDisplay(statsData);
            } else {
                // 如果没有缓存数据，等待1秒再显示
                setTimeout(() => {
                    const statsElement = document.getElementById('stats');
                    if (statsElement) {
                        statsElement.innerHTML = '<p>未能加载统计信息，请访问歌曲列表页刷新数据</p>';
                    }
                }, 1000);
            }
            
            // 更新直播状态
            updateHomeLiveStatus();
        });
        
        function updateStatsDisplay(stats) {
            const statsElement = document.getElementById('stats');
            if (!statsElement) return;
            
            const totalSongs = stats.songCount || 0;
            let html = `<p class="fs-5">歌单总数: <strong class="text-primary">${totalSongs}</strong> 首歌曲</p>`;
            
            if (totalSongs > 0 && stats.genreStats) {
                html += '<div class="d-flex flex-wrap justify-content-center gap-3 mt-4">';
                
                // 只显示数量最多的5种风格
                const topGenres = stats.genreStats.slice(0, 5);
                topGenres.forEach(stat => {
                    const percentage = ((stat.count / totalSongs) * 100).toFixed(1);
                    html += `
                    <div class="genre-card p-3 border rounded text-center" style="min-width: 140px;">
                        <div class="fs-5 fw-bold mb-2">${stat.genre || '未知风格'}</div>
                        <div class="progress" style="height: 15px;">
                            <div class="progress-bar" role="progressbar" 
                                 style="width: ${percentage}%; background-color: #6f42c1;"></div>
                        </div>
                        <div class="mt-2"><small>${stat.count}首 (${percentage}%)</small></div>
                    </div>`;
                });
                
                html += '</div>';
                html += `<div class="mt-4"><a href="songs.html" class="btn btn-outline-purple">查看完整歌单</a></div>`;
            } else {
                html = '<p>未能加载统计信息，请访问歌曲列表页刷新数据</p>';
            }
            
            statsElement.innerHTML = html;
        }
        
        // 首页直播状态更新
        function updateHomeLiveStatus() {
            const liveCard = document.getElementById('liveCard');
            const liveTitle = document.getElementById('liveTitle');
            const liveMessage = document.getElementById('liveMessage');
            const liveBtn = document.getElementById('liveBtn');
            
            if (!liveCard) return;
            
            const isLive = checkLiveStatus();
            
            if (isLive) {
                liveCard.classList.add('bg-danger');
                liveCard.classList.remove('bg-secondary');
                liveTitle.innerHTML = '<i class="bi bi-broadcast-pin"></i> 枝枝正在直播!';
                liveMessage.textContent = '快来直播间和我一起互动吧~';
                liveBtn.classList.add('btn-light');
                liveBtn.classList.remove('btn-outline-light');
            } else {
                liveCard.classList.add('bg-secondary');
                liveCard.classList.remove('bg-danger');
                liveTitle.innerHTML = '<i class="bi bi-mic-mute"></i> 当前未直播';
                liveMessage.textContent = '直播时间：14:00-15:00 / 18:00-19:30';
                liveBtn.classList.add('btn-outline-light');
                liveBtn.classList.remove('btn-light');
            }
            
            // 添加脉动动画（仅在直播时）
            const pulseAnimation = liveCard.querySelector('.pulse-animation');
            if (isLive) {
                if (!pulseAnimation) {
                    const pulse = document.createElement('div');
                    pulse.className = 'pulse-animation';
                    liveCard.appendChild(pulse);
                }
            } else if (pulseAnimation) {
                pulseAnimation.remove();
            }
        }
        
        // 检测直播状态
        function checkLiveStatus() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            
            // 转换为分钟数
            const currentMinutes = hours * 60 + minutes;
            
            // 定义直播时间段（14:00-15:00 和 18:00-19:30）
            const livePeriod1 = { start: 14*60, end: 15*60 };
            const livePeriod2 = { start: 18*60, end: 19*60+30 };
            
            return (currentMinutes >= livePeriod1.start && currentMinutes <= livePeriod1.end) ||
                   (currentMinutes >= livePeriod2.start && currentMinutes <= livePeriod2.end);
        }
    </script>
</body>
</html>
